{% extends "base.html" %}
{% block content %}
<section class="fade-in py-5">
  <div class="container glass-card p-4 shadow-lg">

    {% if c %}
      <div class="row align-items-start">
        <div class="col-md-8">
          <h2 class="title-gradient fw-bold mb-2">{{ c.empresa }}</h2>
          <p class="text-muted mb-1"><strong>{{ t("Rol:") }}</strong> {{ c.rol }}</p>
          <p class="text-muted mb-1"><strong>{{ t("Tipo de cuenta:") }}</strong> {{ c.tipo|capitalize }}</p>
          <p class="text-muted mb-1"><strong>{{ t("Pa√≠s:") }}</strong> {{ c.pais or "‚Äî" }}</p>
          <p class="text-muted mb-1"><strong>{{ t("Tel√©fono:") }}</strong> {{ c.telefono or "‚Äî" }}</p>
          <p class="text-muted mb-3"><strong>{{ t("Direcci√≥n:") }}</strong> {{ c.direccion or t("Sin direcci√≥n registrada") }}</p>
          <p class="mb-4">{{ c.descripcion or t("Esta empresa no ha agregado descripci√≥n a√∫n.") }}</p>

          <!-- üè∑Ô∏è Productos / Servicios -->
          <h5 class="mt-4 mb-3">{{ t("Productos o Servicios disponibles") }}</h5>
          {% if c.items and c.items|length > 0 %}
            <div class="list-group mb-4">
              {% for item in c.items %}
              <div class="list-group-item d-flex justify-content-between align-items-center flex-wrap">
                <div>
                  <h6 class="mb-1">{{ item.nombre }}</h6>
                  <small class="text-muted d-block">{{ item.detalle }}</small>
                  <small class="text-muted">{{ t("Precio:") }} {{ item.precio or t("Consultar") }}</small>
                </div>

                {% if session.get('user') %}
                  {% set u = session.get('user') %}
                  {% if u.tipo in ['extranjero', 'compraventa', 'mixto'] and c.tipo in ['compraventa', 'servicio', 'mixto'] %}
                    <a href="{{ url_for('carrito_agregar', pub_id='direct-' + c.username + '-' + loop.index|string) }}"
                       class="btn btn-success btn-sm mt-2 mt-md-0">
                      <i class="fa-solid fa-cart-plus"></i> {{ t("Agregar al carrito") }}
                    </a>
                  {% endif %}
                {% endif %}
              </div>
              {% endfor %}
            </div>
          {% else %}
            <p class="text-muted">{{ t("No hay productos o servicios publicados por esta empresa.") }}</p>
          {% endif %}
        </div>

        <!-- üí¨ Panel lateral de contacto -->
        <div class="col-md-4 mt-4 mt-md-0">
          <div class="card glass-card shadow-sm">
            <div class="card-body">
              <h5 class="card-title text-center mb-2">
                <i class="fa-regular fa-message"></i> {{ t("Contacto") }}
              </h5>
              <p class="text-center small text-muted mb-3">
                {{ t("Env√≠a un mensaje directo o agr√©galo al carrito para negociar.") }}
              </p>

              {% if session.get('user') %}
                {% set user = session.get('user') %}
                {% if user.email != c.email %}
                  <form method="post" action="{{ url_for('mensajes') }}">
                    <input type="hidden" name="destino" value="{{ c.email }}">
                    <div class="mb-2">
                      <textarea class="form-control form-control-sm" name="contenido"
                                placeholder="{{ t('Escribe tu mensaje...') }}" required></textarea>
                    </div>
                    <button type="submit" class="btn btn-outline-primary w-100 btn-sm">
                      <i class="fa-regular fa-paper-plane"></i> {{ t("Enviar mensaje") }}
                    </button>
                  </form>
                  <p class="text-muted mt-2 small text-center">
                    {{ t("Puedes volver a enviar mensaje a esta empresa despu√©s de 3 d√≠as.") }}
                  </p>
                {% else %}
                  <p class="text-center text-muted">{{ t("No puedes enviarte mensajes a ti mismo.") }}</p>
                {% endif %}
              {% else %}
                <p class="text-center">
                  <a href="{{ url_for('login') }}" class="btn btn-sm btn-primary">
                    <i class="fa-solid fa-key"></i> {{ t("Inicia sesi√≥n para contactar") }}
                  </a>
                </p>
              {% endif %}
            </div>
          </div>
        </div>
      </div>

    {% else %}
      <p class="text-center text-muted fs-5">
        {{ t("No se encontr√≥ la empresa solicitada o fue eliminada de tu vista.") }}
      </p>
    {% endif %}

  </div>
</section>
{% endblock %}
