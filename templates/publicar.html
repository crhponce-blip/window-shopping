{% extends "base.html" %}
{% block content %}
<section class="fade-in py-5">
  <div class="container col-md-6 glass-card p-4 shadow-lg">
    <h2 class="title-gradient text-center mb-4">üìù {{ t("Nueva Publicaci√≥n") }}</h2>

    <form method="POST" action="{{ url_for('publicar') }}">
      <!-- üîπ Subtipo (Oferta / Demanda) -->
      <div class="mb-3">
        <label for="subtipo" class="form-label">{{ t("Selecciona el subtipo") }}</label>
        <select class="form-select" id="subtipo" name="subtipo" required>
          {% for s in subtipo_permitidos %}
          <option value="{{ s }}">{{ "üì¶" if s == "oferta" else "üì•" }} {{ t(s|capitalize) }}</option>
          {% endfor %}
        </select>
        <small class="text-muted">
          {{ t("Define si est√°s ofreciendo o solicitando un producto o servicio") }}
        </small>
      </div>

      <!-- üîπ Tipo de publicaci√≥n -->
      <div class="mb-3">
        <label for="tipo_publicacion" class="form-label">{{ t("Tipo de publicaci√≥n") }}</label>
        <select class="form-select" id="tipo_publicacion" name="tipo_publicacion" required>
          {% for tipo in tipos_publicacion %}
          {% if tipo == "venta" %}
          <option value="venta">üí∞ {{ t("Venta") }}</option>
          {% elif tipo == "compra" %}
          <option value="compra">üõçÔ∏è {{ t("Compra") }}</option>
          {% elif tipo == "servicio" %}
          <option value="servicio">‚öôÔ∏è {{ t("Servicio") }}</option>
          {% else %}
          <option value="{{ tipo }}">{{ t(tipo|capitalize) }}</option>
          {% endif %}
          {% endfor %}
        </select>
        <small class="text-muted">
          {{ t("Solo se mostrar√°n opciones v√°lidas seg√∫n tu tipo de cuenta") }}
        </small>
      </div>

      <!-- üîπ Nombre -->
      <div class="form-floating mb-3">
        <input type="text" name="producto" id="producto" class="form-control"
               placeholder="{{ t('Ej: Cereza Lapins 9.5 / Flete RM-Valpo') }}" required>
        <label for="producto">{{ t("Nombre del producto o servicio") }}</label>
      </div>

      <!-- üîπ Descripci√≥n -->
      <div class="form-floating mb-3">
        <textarea name="descripcion" id="descripcion" class="form-control"
                  placeholder="{{ t('Describe brevemente tu oferta o solicitud...') }}"
                  style="height: 120px" required></textarea>
        <label for="descripcion">{{ t("Descripci√≥n") }}</label>
      </div>

      <!-- üîπ Precio -->
      <div class="form-floating mb-3">
        <input type="text" name="precio" id="precio" class="form-control" placeholder="USD 1.00/kg">
        <label for="precio">{{ t("Precio (opcional)") }}</label>
      </div>

      <!-- üîπ Servicio objetivo (solo si es demanda de servicio) -->
      <div class="mb-3" id="grupo_objetivo" style="display:none;">
        <label for="servicio_objetivo" class="form-label">{{ t("Servicio objetivo") }}</label>
        <select class="form-select" id="servicio_objetivo" name="servicio_objetivo">
          <option value="">{{ t("Selecciona a qui√©n buscas") }}</option>
          <option value="Transporte">{{ t("Transporte") }}</option>
          <option value="Packing">{{ t("Packing") }}</option>
          <option value="Frigor√≠fico">{{ t("Frigor√≠fico") }}</option>
          <option value="Extraportuarios">{{ t("Extraportuarios") }}</option>
          <option value="Agencia de Aduanas">{{ t("Agencia de Aduanas") }}</option>
        </select>
        <small class="text-muted">
          {{ t("Solo requerido si est√°s solicitando un servicio espec√≠fico") }}
        </small>
      </div>

      <!-- üîò Bot√≥n de env√≠o -->
      <div class="d-grid">
        <button type="submit" class="btn btn-primary btn-lg">üöÄ {{ t("Publicar") }}</button>
      </div>
    </form>
  </div>
</section>

<!-- üí° L√≥gica din√°mica para mostrar/ocultar campos -->
<script>
  document.addEventListener("DOMContentLoaded", function() {
    const subtipo = document.getElementById("subtipo");
    const tipoSelect = document.getElementById("tipo_publicacion");
    const grupoObjetivo = document.getElementById("grupo_objetivo");

    function mostrarObjetivo() {
      const esDemanda = subtipo.value === "demanda";
      const esServicio = tipoSelect.value === "servicio";
      grupoObjetivo.style.display = (esDemanda && esServicio) ? "block" : "none";
    }

    subtipo.addEventListener("change", mostrarObjetivo);
    tipoSelect.addEventListener("change", mostrarObjetivo);
    mostrarObjetivo();
  });
</script>
{% endblock %}
