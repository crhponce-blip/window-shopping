{% extends "base.html" %}
{% block content %}
<section class="fade-in py-5">
  <div class="container col-md-6 glass-card p-4 shadow-lg">
    <h2 class="title-gradient text-center mb-4">ğŸ“ {{ t("Nueva PublicaciÃ³n") }}</h2>

    <form method="POST" action="{{ url_for('publicar') }}">
      <!-- Subtipo: Oferta o Demanda -->
      <div class="mb-3">
        <label for="subtipo" class="form-label">{{ t("Selecciona el subtipo") }}</label>
        <select class="form-select" id="subtipo" name="subtipo" required>
          <option value="oferta">ğŸ“¦ {{ t("Oferta") }}</option>
          <option value="demanda">ğŸ“¥ {{ t("Demanda") }}</option>
        </select>
        <small class="text-muted">
          {{ t("Define si estÃ¡s ofreciendo o solicitando un producto o servicio") }}
        </small>
      </div>

      <!-- Tipo de publicaciÃ³n: controlado segÃºn rol -->
      <div class="mb-3">
        <label for="tipo_publicacion" class="form-label">{{ t("Tipo de publicaciÃ³n") }}</label>
        <select class="form-select" id="tipo_publicacion" name="tipo_publicacion" required>
          <option value="venta">ğŸ’° {{ t("Venta") }}</option>
          <option value="compra">ğŸ›ï¸ {{ t("Compra") }}</option>
          <option value="servicio">âš™ï¸ {{ t("Servicio") }}</option>
        </select>
        <small class="text-muted">
          {{ t("Solo se mostrarÃ¡n opciones vÃ¡lidas segÃºn tu rol") }}
        </small>
      </div>

      <!-- Nombre -->
      <div class="form-floating mb-3">
        <input type="text" name="producto" id="producto"
               class="form-control"
               placeholder="{{ t('Ej: Cereza Lapins 9.5') }}" required>
        <label for="producto">{{ t("Nombre del producto o servicio") }}</label>
      </div>

      <!-- DescripciÃ³n -->
      <div class="form-floating mb-3">
        <textarea name="descripcion" id="descripcion" class="form-control"
                  placeholder="{{ t('Describe brevemente tu oferta o solicitud...') }}"
                  style="height: 120px" required></textarea>
        <label for="descripcion">{{ t("DescripciÃ³n") }}</label>
      </div>

      <!-- Precio -->
      <div class="form-floating mb-3">
        <input type="text" name="precio" id="precio"
               class="form-control" placeholder="USD 1.00/kg">
        <label for="precio">{{ t("Precio (opcional)") }}</label>
      </div>

      <!-- BotÃ³n -->
      <div class="d-grid">
        <button type="submit" class="btn btn-primary btn-lg">
          ğŸš€ {{ t("Publicar") }}
        </button>
      </div>
    </form>
  </div>
</section>

<script>
  // âš™ï¸ Control dinÃ¡mico segÃºn subtipo y tipo de cuenta (cliente, productor, etc.)
  document.addEventListener("DOMContentLoaded", function() {
    const subtipo = document.getElementById("subtipo");
    const tipoSelect = document.getElementById("tipo_publicacion");

    function actualizarOpciones() {
      const s = subtipo.value;
      tipoSelect.innerHTML = "";

      if (s === "oferta") {
        tipoSelect.innerHTML += `<option value="venta">ğŸ’° {{ t("Venta") }}</option>`;
        tipoSelect.innerHTML += `<option value="servicio">âš™ï¸ {{ t("Servicio") }}</option>`;
      } else {
        tipoSelect.innerHTML += `<option value="compra">ğŸ›ï¸ {{ t("Compra") }}</option>`;
        tipoSelect.innerHTML += `<option value="servicio">âš™ï¸ {{ t("Servicio") }}</option>`;
      }
    }

    subtipo.addEventListener("change", actualizarOpciones);
    actualizarOpciones();
  });
</script>
{% endblock %}
