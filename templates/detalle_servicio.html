{% extends "base.html" %}
{% block content %}
<h2>Servicios disponibles</h2>

<form method="GET">
  <input type="text" name="q" placeholder="Buscar empresa o servicio..." value="{{ query }}">
  <input type="submit" value="Buscar">
</form>

{% if data %}
  <form method="POST" action="{{ url_for('cart_add_bulk') }}">
    <table>
      <tr>
        <th></th>
        <th>Empresa</th>
        <th>Rol</th>
        <th>Descripción</th>
        <th>Servicios ofrecidos</th>
        <th>Acción</th>
      </tr>
      {% for d in data %}
      <tr>
        <td><input type="checkbox" name="sel" value='{{ d|tojson }}'></td>
        <td><a href="{{ url_for('cliente_detalle', username=d.username) }}">{{ d.empresa }}</a></td>
        <td>{{ d.rol }}</td>
        <td>{{ d.descripcion }}</td>
        <td>
          <ul>
            {% for it in d.items %}
              {% if it.tipo == 'servicio' %}
              <li>
                {{ it.servicio }} — {{ it.capacidad }} ({{ it.ubicacion }})
              </li>
              {% endif %}
            {% endfor %}
          </ul>
        </td>
        <td>
          <form method="POST" action="{{ url_for('cart_add') }}">
            <input type="hidden" name="empresa" value="{{ d.empresa }}">
            <input type="hidden" name="servicio" value="{{ it.servicio }}">
            <input type="hidden" name="cantidad" value="{{ it.capacidad }}">
            <input type="hidden" name="origen" value="{{ it.ubicacion }}">
            <input type="submit" value="Agregar" class="btn success">
          </form>
        </td>
      </tr>
      {% endfor %}
    </table>
    <br>
    <input type="submit" value="Agregar seleccionados al carrito" class="btn success">
  </form>
{% else %}
  <p>No hay servicios publicados actualmente.</p>
{% endif %}
{% endblock %}
