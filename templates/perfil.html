{% extends "base.html" %}
{% block title %}Perfil de {{ perfil.empresa }} | Window Shopping{% endblock %}
{% block content %}

<div class="form-container">
  <h2>üè¢ {{ perfil.empresa }}</h2>
  <p><strong>Tipo de Usuario:</strong> {{ perfil.tipo }}</p>
  <p><strong>Ubicaci√≥n:</strong> {{ perfil.origen or "Chile" }}</p>
  <p><strong>Contacto:</strong> {{ perfil.email or "No disponible" }}</p>

  <hr />

  <h3>Productos / Servicios disponibles</h3>
  {% if perfil.items and perfil.items|length > 0 %}
    <div class="item-list">
      {% for item in perfil.items %}
      <div class="item-card">
        <strong>{{ item.producto or item.servicio }}</strong><br />
        <span>Cantidad: {{ item.cantidad or "N/A" }}</span><br />
        <span>Origen: {{ item.origen or "Chile" }}</span><br />
        <form method="post" action="{{ url_for('cart_add') }}">
          <input type="hidden" name="empresa" value="{{ perfil.empresa }}">
          <input type="hidden" name="producto" value="{{ item.producto }}">
          <input type="hidden" name="cantidad" value="{{ item.cantidad }}">
          <input type="hidden" name="origen" value="{{ item.origen }}">
          <button type="submit" class="btn-primary">Agregar al Carrito</button>
        </form>
      </div>
      {% endfor %}
    </div>
  {% else %}
    <p>Esta empresa no tiene productos disponibles actualmente.</p>
  {% endif %}

  <hr />

  {% if puede_enviar %}
    <form method="post" action="{{ url_for('enviar_mensaje') }}">
      <input type="hidden" name="destinatario" value="{{ perfil.username }}">
      <textarea name="mensaje" rows="4" placeholder="Escribe tu mensaje..."></textarea>
      <button type="submit" class="btn-primary">Enviar mensaje</button>
    </form>
  {% else %}
    <p class="msg-info">üïì Ya enviaste un mensaje recientemente. Podr√°s volver a enviar uno en {{ dias_restantes }} d√≠a(s).</p>
  {% endif %}
</div>

{% endblock %}
