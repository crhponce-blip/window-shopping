{% extends "base.html" %}
{% block title %}{{ t("Ofertas disponibles","Available Offers","可供應商品") }}{% endblock %}
{% block content %}
<div class="detalle-container" style="max-width:980px;margin:26px auto">
  <h2>{{ t("Ofertas de productos disponibles","Available Product Offers","可購買商品清單") }}</h2>
  <form method="GET" style="display:flex;gap:8px;margin:10px 0">
    <input type="text" name="q" placeholder="{{ t('Buscar producto o empresa...','Search product or company...','搜尋產品或公司...') }}" value="{{ query }}">
    <button class="btn btn-secondary">{{ t("Buscar","Search","搜尋") }}</button>
  </form>

  <ul style="display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:12px;list-style:none;padding:0">
    {% for c in data %}
      {% for item in c.items if item.tipo in ['oferta','producto'] %}
      <li style="background:rgba(255,255,255,.08);padding:14px;border-radius:10px;">
        <h3 style="margin:0 0 6px">{{ c.empresa }}</h3>
        <p><b>{{ t("Producto:","Product:","產品：") }}</b> {{ item.producto }}</p>
        {% if item.variedad %}<p><b>{{ t("Variedad:","Variety:","品種：") }}</b> {{ item.variedad }}</p>{% endif %}
        {% if item.cantidad %}<p><b>{{ t("Cantidad:","Quantity:","數量：") }}</b> {{ item.cantidad }}</p>{% endif %}
        {% if item.origen %}<p><b>{{ t("Origen:","Origin:","來源：") }}</b> {{ item.origen }}</p>{% endif %}
        {% if item.precio_caja %}<p><b>{{ t("Precio/Caja:","Price/Box:","每箱價格：") }}</b> {{ item.precio_caja }}</p>{% endif %}
        <div style="display:flex;gap:8px;flex-wrap:wrap;margin-top:8px">
          <form method="post" action="{{ url_for('cart_add') }}">
            <input type="hidden" name="username" value="{{ c.username }}">
            <input type="hidden" name="tipo" value="compras">
            <button class="btn btn-success">{{ t("Agregar al carrito 🛒","Add to cart 🛒","加入購物車 🛒") }}</button>
          </form>
          <a class="btn btn-secondary" href="{{ url_for('cliente_detalle', username=c.username) }}">{{ t("Ver perfil","View profile","查看資料") }}</a>
        </div>
      </li>
      {% endfor %}
    {% else %}
      <li>{{ t("No hay ofertas disponibles actualmente.","No offers available at the moment.","目前沒有可用的商品供應。") }}</li>
    {% endfor %}
  </ul>
</div>
{% endblock %}
