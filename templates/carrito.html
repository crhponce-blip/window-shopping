{% extends "base.html" %}
{% block content %}
<section class="fade-in py-5">
  <div class="container glass-card p-4 shadow-lg">
    <h2 class="title-gradient text-center mb-4">ğŸ’¬ {{ t("Mensajes") }}</h2>

    {% if user %}
    <div class="row">
      <!-- ğŸ“¥ Bandeja de Entrada -->
      <div class="col-md-6 mb-4">
        <h4 class="mb-3 text-primary">ğŸ“¥ {{ t("Bandeja de Entrada") }}</h4>
        {% if mensajes and mensajes|selectattr("destino", "equalto", user.email)|list %}
          <div class="list-group">
            {% for m in mensajes if m.destino == user.email %}
            <div class="list-group-item glass-card mb-2 p-3">
              <p class="mb-1">
                <strong>{{ t("De:") }}</strong> {{ m.remitente }}
              </p>
              <p class="small text-muted mb-1">
                {{ t("Fecha:") }} {{ m.fecha }}
              </p>
              <p class="mb-2">{{ m.contenido }}</p>
              <form method="POST" action="{{ url_for('eliminar_mensaje', msg_id=m.id) }}" class="text-end">
                <button type="submit" class="btn btn-sm btn-outline-danger">
                  âŒ {{ t("Eliminar") }}
                </button>
              </form>
            </div>
            {% endfor %}
          </div>
        {% else %}
          <p class="text-muted">{{ t("No tienes mensajes recibidos.") }}</p>
        {% endif %}
      </div>

      <!-- ğŸ“¤ Bandeja de Salida -->
      <div class="col-md-6 mb-4">
        <h4 class="mb-3 text-success">ğŸ“¤ {{ t("Enviados") }}</h4>
        {% if mensajes and mensajes|selectattr("remitente", "equalto", user.email)|list %}
          <div class="list-group">
            {% for m in mensajes if m.remitente == user.email %}
            <div class="list-group-item glass-card mb-2 p-3">
              <p class="mb-1">
                <strong>{{ t("Para:") }}</strong> {{ m.destino }}
              </p>
              <p class="small text-muted mb-1">
                {{ t("Fecha:") }} {{ m.fecha }}
              </p>
              <p class="mb-2">{{ m.contenido }}</p>
              <form method="POST" action="{{ url_for('eliminar_mensaje', msg_id=m.id) }}" class="text-end">
                <button type="submit" class="btn btn-sm btn-outline-danger">
                  âŒ {{ t("Eliminar") }}
                </button>
              </form>
            </div>
            {% endfor %}
          </div>
        {% else %}
          <p class="text-muted">{{ t("No has enviado mensajes aÃºn.") }}</p>
        {% endif %}
      </div>
    </div>

    <!-- âœ‰ï¸ Nuevo Mensaje -->
    <div class="mt-5">
      <h4 class="text-center mb-3">ğŸ“ {{ t("Enviar un nuevo mensaje") }}</h4>
      <form method="POST" action="{{ url_for('mensajes') }}" class="row g-3 justify-content-center">
        <div class="col-md-6">
          <label class="form-label fw-bold">{{ t("Destinatario (correo)") }}</label>
          <input type="email" name="destino" class="form-control" placeholder="usuario@ws.com" required>
        </div>

        <div class="col-md-8">
          <label class="form-label fw-bold">{{ t("Mensaje") }}</label>
          <textarea name="contenido" class="form-control" rows="3" 
                    placeholder="{{ t('Escribe tu mensaje aquÃ­...') }}" required></textarea>
        </div>

        <div class="col-12 text-center mt-2">
          <button type="submit" class="btn btn-primary px-5">
            ğŸš€ {{ t("Enviar mensaje") }}
          </button>
        </div>
      </form>
    </div>

    {% else %}
      <p class="text-center text-muted fs-5">
        {{ t("Debes iniciar sesiÃ³n para ver o enviar mensajes.") }}
      </p>
      <div class="text-center mt-3">
        <a href="{{ url_for('login') }}" class="btn btn-primary">
          ğŸ”‘ {{ t("Iniciar sesiÃ³n") }}
        </a>
      </div>
    {% endif %}
  </div>
</section>
{% endblock %}
